% Semestral work for class BI-TEX - template for exams

\setbox0=\hbox{\bf Q1: }
\parindent=\wd0 % So that when "Qn: " is written, it would start nicely below

\font\courseTitle=cmb10 at 17pt

\hoffset=-18pt
\voffset=-18pt
\hsize=\dimexpr597pt-54pt-54pt
\vsize=\dimexpr845pt-54pt-54pt

\footline{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Inputs begin
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input tikz

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Inputs end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Variables begin
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcount\questionCnt\questionCnt=1  % Question numbers start at 1
\newcount\subquestionCnt\subquestionCnt=`a  % Subquestions start at a
\newcount\i % Help in loops

\newwrite\countFileOut
\newread\countFileIn

\def\questionSingle{single}
\def\questionMultiple{multi}
\def\questionTF{tf}
\def\questionSub{sub}
\def\questionType{none}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Variables end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definition of internal macros begin
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\centerOptionMark#1{\hbox to 40pt{\hss#1\hss}}

\def\singleChoiceBox{%
    \hbox{%
        \tikz \draw (0,0) circle (3pt);%
    }%
}

\def\multiChoiceBox{%
    \lower 1.7pt
    \hbox{%
        \vrule width 0.4pt height 10pt
        \vbox{%
            \hrule width 9.2pt height 0.4pt
            \vskip 9.2pt
            \hrule width 9.2pt height 0.4pt
        }%               
        \vrule width 0.4pt height 10pt
    }%
}

\def\TFBox{%
    \hbox{%
        \multiChoiceBox
        \kern 3pt
        \multiChoiceBox
    }%
}

\def\question#1#2{%
    \ifx\questionType\questionSub
        \char\subquestionCnt)
    \else
        \noindent
        {\bf Q\the\questionCnt: }%
    \fi
    #1%
    \ifx#2\empty\else~(#2{\it p})\fi
    \vfil
    \par\vskip 5pt
}

\def\answerQuestion#1#2#3{%
    \setbox0=\vbox{%
        \question{#1}{#2}%
        \vskip #3
    }%
    \ifnum\ht0 > \dimexpr\pagegoal-\pagetotal
        \break
    \fi
    \box0
    \par
}

\def\saveQuestionCnt{%
    \immediate\openout\countFileOut=questioncnt.dat
    \immediate\write\countFileOut{\the\questionCnt}%
    \immediate\closeout\countFileOut
}

\def\printScoring{%
    \openin\countFileIn=questioncnt.dat
    \ifeof\countFileIn
        \questionCnt=0
    \else
        \read\countFileIn to \x
        \closein\countFileIn
        \questionCnt=\x
    \fi

    \hbox to \hsize{
        \hss
        \vbox to 3em{%
            \vss
            \hbox{Question\hfil}%
            \vskip 10.5pt
            \hbox{Points\hfil}%
            \vss
        }%
        \hskip 5pt
        \vrule\hskip 1pt\vrule
        \hskip 5pt
        \i=0
        \loop
            \advance\i by 1
            \vbox to 3em{%
                \vss
                \hbox to 1cm{\hfil\the\i\hfil}%
                \vskip 10pt
                \hbox to 1cm{\hfil\phantom{P}}%
                \vss
            }%
            \ifnum\i<\questionCnt
                \repeat
        \hss
    }

    \questionCnt=1  % Set back to 1
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definition of internal macros end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definition of external macros begin
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\setcourse#1{%
    \def\course{#1}%
    \def\headerPresent{}%
}

\def\setvariant#1{%
    \def\variant{#1}%
    \def\headerPresent{}%
}

\def\includenameinheader{%
    \def\printName{}%
    \def\headerPresent{}%
}

\def\includescoring{%
    \def\includeScoring{}%
    \def\headerPresent{}%
}

\def\printheader{%
    \setbox1=\hbox to \hsize{%
        \ifx\variant\undefined\else
            \rlap{Variant: {\bf\variant}}%
        \fi
        \ifx\course\undefined\else
            \hbox to \hsize{%
                \courseTitle
                \hss\course\hss
            }%
        \fi
        \ifx\printName\undefined\else
            \llap{%
                \hbox to 5cm{%
                    Name: \leaders\hbox{.}\hfil
                }%
            }%
        \fi
    }%

    % If scoring and there is no box above, don't vskip
    \ifdim\ht1=0pt\else
        \box1
        \ifx\includeScoring\undefined\else
            \vskip 1cm
        \fi
    \fi

    \ifx\includeScoring\undefined\else

        \printScoring
    \fi    

    \ifx\headerPresent\undefined\else
        \vskip 0.7cm
        \hrule
        \vskip 1cm
    \fi
}

\def\singlechoicequestion#1#2{%
    \def\questionType{single}%
    \question{#1}{#2}%
    \saveQuestionCnt
    \advance\questionCnt by 1
}

\def\multichoicequestion#1#2{%
    \def\questionType{multi}%
    \question{#1}{#2}%
    \saveQuestionCnt
    \advance\questionCnt by 1
}

\def\truefalsequestion#1#2{%
    \def\questionType{tf}%
    \question{#1}{#2}%
    \saveQuestionCnt
    \advance\questionCnt by 1
    {\bf\hskip 1pt T\kern 6pt F}%
    \par\vskip 3pt
}

\def\choice#1{%
    \noindent\hskip\parindent
    \ifx\questionType\questionSingle
        \hbox to 10pt{\hss\singleChoiceBox\hss}%
        \kern 4pt
    \fi
    \ifx\questionType\questionMultiple
        \hbox to 10pt{\hss\multiChoiceBox\hss}%
        \kern 6pt
    \fi
    \ifx\questionType\questionTF
        \TFBox
        \kern 6pt
    \fi
    \vtop{%
        \noindent\hsize=\dimexpr\hsize-15pt-40pt
        #1
    }%
    \par\vskip 3pt
}

\def\endchoicequestion{%
    \vskip 12pt
    \def\questionType{none}%
}

\def\answerquestion#1#2#3{%
    \answerQuestion{#1}{#2}{#3}%
    \ifx\questionType\questionSub
        \advance\subquestionCnt by 1
    \else
        \saveQuestionCnt
        \advance\questionCnt by 1
    \fi
    \par\vskip 3pt
}

\def\subquestions#1#2{%
    \question{#1}{#2}%
    \def\questionType{sub}%
    \saveQuestionCnt
    \advance\questionCnt by 1
}

\def\endsubquestions{%
    \vskip 12pt
    \def\questionType{none}%
    \subquestionCnt=`a
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Definition of external macros end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Example usage

\setcourse{BI-TEX}
\setvariant{A}
\includenameinheader
\includescoring

\printheader

\singlechoicequestion{What is $2 + 2$?}{}
\choice{Hello how are you. I wanted to text you about this wonderful class Im taking right now, it is called BI-TEX.}
\choice{3}
\choice{4}
\choice{5}
\endchoicequestion

\multichoicequestion{Which is a prime number?}{2}
\choice{2}
\choice{4}
\choice{6}
\choice{7}
\endchoicequestion

\truefalsequestion{Mark even numbers.}{}
\choice{1}
\choice{2}
\choice{3}
\choice{4}
\endchoicequestion

\answerquestion{How many prime numbers are there?}{2}{4cm}

\answerquestion{How many prime numbers are there? Prove it.}{4}{6cm}

\subquestions{Question with multiple subquestions.}{5}
\answerquestion{Solve for $3x + 9 = 12x - 18$}{2}{2cm}
\answerquestion{Solve for $2x^2 + 6 = 4x + 6$}{3}{4cm}
\endsubquestions

\bye
